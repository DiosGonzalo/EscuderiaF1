<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Escudería F1 - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
</head>

<body class="bg-dark text-light">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-black fixed-top shadow-lg">
        <div class="container-fluid px-4">
            <a class="navbar-brand fw-bold fs-4 text-warning" href="#">
                <i class="bi bi-speedometer2 me-2"></i>
                Escudería F1
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active fw-semibold" th:href="@{/dashboard}">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-semibold" th:href="@{/garaje}">
                            <i class="bi bi-car-front-fill"></i> Garaje
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-semibold" th:href="@{/almacen}">
                            <i class="bi bi-box-seam"></i> Almacén
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link fw-semibold" th:href="@{/carreras}">
                            <i class="bi bi-flag-fill"></i> Carreras
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container py-5 mt-5">

        <!-- Título principal -->
        <div class="text-center mb-5 animate__animated animate__fadeInDown">
            <h1 class="display-3 fw-bold text-warning mb-3">Panel de Control</h1>
            <div class="bg-warning mx-auto mb-3 rounded" style="height: 4px; width: 80px;"></div>
            <p class="lead text-light">Gestiona tu escudería de Fórmula 1</p>
        </div>

        <!-- Botones de navegación rápida -->
        <div class="row g-4 mb-5">
            <div class="col-md-4 animate__animated animate__fadeInUp">
                <a th:href="@{/garaje}" class="btn btn-warning w-100 py-4 rounded-4 shadow-lg text-decoration-none text-dark">
                    <i class="bi bi-car-front-fill fs-1 d-block mb-2"></i>
                    <h5 class="mb-0">Ir a Garaje</h5>
                </a>
            </div>
            <div class="col-md-4 animate__animated animate__fadeInUp animate__delay-1s">
                <a th:href="@{/almacen}" class="btn btn-success w-100 py-4 rounded-4 shadow-lg text-decoration-none">
                    <i class="bi bi-box-seam fs-1 d-block mb-2"></i>
                    <h5 class="mb-0">Ir a Almacén</h5>
                </a>
            </div>
            <div class="col-md-4 animate__animated animate__fadeInUp animate__delay-2s">
                <a th:href="@{/carreras}" class="btn btn-danger w-100 py-4 rounded-4 shadow-lg text-decoration-none">
                    <i class="bi bi-flag-fill fs-1 d-block mb-2"></i>
                    <h5 class="mb-0">Ir a Carreras</h5>
                </a>
            </div>
        </div>

        <!-- Sección de Coches -->
        <section class="mb-5 animate__animated animate__fadeInLeft">
            <div class="text-center mb-4">
                <h2 class="display-6 fw-bold text-warning">Coches de la Escudería</h2>
                <div class="bg-warning mx-auto rounded" style="height: 4px; width: 80px;"></div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4 animate__animated animate__zoomIn" th:each="coche : ${coches}">
                    <div class="card h-100 rounded-4 shadow-lg border-warning bg-black text-light">
                        <div class="position-relative overflow-hidden rounded-top-4">
                            <img th:src="${coche.imagen}" class="card-img-top" style="height: 220px; object-fit: cover;" alt="Imagen del coche">
                            <div class="position-absolute top-0 end-0 p-3">
                                <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">
                                    <i class="bi bi-car-front"></i> F1
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title fw-bold text-warning mb-3" th:text="${coche.modelo}">Modelo</h5>
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-person-fill text-warning me-2"></i>
                                <small class="text-muted">Piloto:</small>
                            </div>
                            <p class="lead fw-semibold text-light mb-0" th:text="${coche.piloto ?: 'Sin Asignar'}">Nombre Piloto</p>
                        </div>
                        <div class="card-footer bg-black border-warning p-3">
                            <a th:href="@{/garaje/{id}(id=${coche.id})}" class="btn btn-warning w-100 rounded-3">
                                <i class="bi bi-eye"></i> Ver Detalles
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Componentes -->
        <section class="mb-5 animate__animated animate__fadeInRight">
            <div class="text-center mb-4">
                <h2 class="display-6 fw-bold text-warning">Componentes del Almacén</h2>
                <div class="bg-warning mx-auto rounded" style="height: 4px; width: 80px;"></div>
            </div>

            <div th:each="tipo : ${tipos}" class="mb-5">
                <h3 class="h4 fw-bold text-dark bg-warning rounded-3 p-3 shadow animate__animated animate__bounceIn" th:text="${tipo}">
                    Tipo de Componente
                </h3>

                <div class="row g-4 mt-3">
                    <div class="col-sm-6 col-md-4 col-lg-3 animate__animated animate__fadeInUp" 
                         th:each="comp : ${componente}" 
                         th:if="${comp.tipo.name().equalsIgnoreCase(tipo)}">
                        <div class="card h-100 rounded-4 shadow-lg border-warning bg-black text-light">
                            <div class="card-header border-warning pt-3 pb-0" 
                                 th:classappend="${comp.coche != null} ? 'bg-danger text-white' : 'bg-dark'">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0 fw-bold text-truncate" th:text="${comp.nombre}">Componente</h6>
                                    <span class="badge rounded-pill" 
                                          th:classappend="${comp.coche != null} ? 'bg-white text-danger' : 'bg-success'"
                                          th:attr="data-bs-toggle='tooltip', data-bs-title=${comp.coche != null ? 'En uso' : 'Disponible'}">
                                        <i th:class="${comp.coche != null ? 'bi bi-gear-fill' : 'bi bi-check-circle-fill'}"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-muted">
                                            <i class="bi bi-speedometer text-warning"></i> Potencia
                                        </small>
                                        <strong class="text-light" th:text="${comp.caballos} + ' CV'">0 CV</strong>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-muted">
                                            <i class="bi bi-activity text-success"></i> Estado
                                        </small>
                                        <strong class="text-light" th:text="${#numbers.formatDecimal(comp.estado * 100, 0, 0)} + '%'">100%</strong>
                                    </div>
                                    <div th:if="${comp.coche != null}" class="alert alert-warning p-2 mb-0 mt-2 small border-0">
                                        <i class="bi bi-car-front-fill"></i> 
                                        <strong>En coche:</strong> <span th:text="${comp.coche.piloto}"></span>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-light fw-semibold">Uso del componente</small>
                                        <small class="text-muted">
                                            <span th:text="${comp.vecesUsado}">0</span>/<span th:text="${comp.limiteUsos}">0</span>
                                        </small>
                                    </div>
                                    <div class="progress rounded-pill" style="height: 8px;">
                                        <div class="progress-bar rounded-pill" 
                                             th:classappend="${(comp.vecesUsado / comp.limiteUsos) >= 0.8} ? 'bg-danger' : (${(comp.vecesUsado / comp.limiteUsos) >= 0.5} ? 'bg-warning' : 'bg-success')"
                                             role="progressbar"
                                             th:style="'width: ' + ((${comp.vecesUsado} * 100) / ${comp.limiteUsos}) + '%'"
                                             th:attr="aria-valuenow=${comp.vecesUsado}, aria-valuemin='0', aria-valuemax=${comp.limiteUsos}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-black border-warning">
                                <a th:href="@{/almacen/{id}(id=${comp.id})}" class="btn btn-info btn-sm w-100 rounded-3 text-white">
                                    <i class="bi bi-info-circle"></i> Ver Detalles
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-12" th:if="${noHayComponentesDelTipo}">
                        <p>No hay componentes de este tipo.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sección de Carreras -->
        <section class="mb-5 animate__animated animate__fadeInUp">
            <div class="text-center mb-4">
                <h2 class="display-6 fw-bold text-warning">Próximas Carreras</h2>
                <div class="bg-warning mx-auto rounded" style="height: 4px; width: 80px;"></div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4 animate__animated animate__zoomIn" th:each="carrera : ${carrera}">
                    <div class="card h-100 rounded-4 shadow-lg border-warning bg-black overflow-hidden">
                        <div class="position-relative">
                            <img th:src="${carrera.imagen}" 
                                 class="card-img-top" 
                                 style="height: 250px; object-fit: cover; filter: brightness(0.7);" 
                                 alt="Imagen de la carrera">
                            
                            <div class="card-img-overlay d-flex flex-column justify-content-end p-4">
                                <span class="badge bg-warning text-dark mb-2 align-self-start px-3 py-2 rounded-pill shadow-sm">
                                    <i class="bi bi-calendar-event"></i>
                                    <span th:text="${#dates.format(carrera.fecha, 'dd/MM/yyyy')}">Fecha</span>
                                </span>
                                <h4 class="card-title fw-bold text-white mb-2" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);" th:text="${carrera.nombre}">
                                    Nombre de la Carrera
                                </h4>
                                <p class="text-white mb-3">
                                    <small style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                                        <i class="bi bi-car-front-fill"></i>
                                        Coches Inscritos: 
                                        <strong th:text="${carrera.coches != null ? carrera.coches.size() : 0}">0</strong>
                                    </small>
                                </p>
                                <a th:href="@{/carreras/{id}(id=${carrera.id})}" 
                                   class="btn btn-warning fw-semibold rounded-pill px-4 align-self-start">
                                    <i class="bi bi-arrow-right"></i> Ver Detalles
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 animate__animated animate__pulse" th:if="${#lists.isEmpty(carrera)}">
                    <div class="alert alert-dark border-warning shadow-sm text-center py-5">
                        <i class="bi bi-calendar-x text-warning" style="font-size: 4rem;"></i>
                        <h5 class="mt-3 text-light">No hay carreras programadas</h5>
                        <p class="text-muted mb-0">Las próximas carreras aparecerán aquí</p>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer class="bg-black text-warning text-center py-4 mt-5 shadow-lg border-top border-warning">
        <div class="container">
            <p class="mb-0">
                <i class="bi bi-speedometer2"></i>
                <strong>Escudería F1</strong> - Sistema de Gestión
            </p>
            <small class="text-muted">Powered by Bootstrap 5</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Inicializar tooltips de Bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });
    </script>
</body>
</html>